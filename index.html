<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è¿·è·¯æ•‘æ´å®šä½ç³»çµ± / è¿·å­æ•‘æ´ä½ç½®ç¢ºèªã‚·ã‚¹ãƒ†ãƒ </title>
  <style>
    body{font-family:"Noto Sans TC",system-ui,Segoe UI,Roboto,Arial; background: linear-gradient(180deg,#cdeac0 0%,#a8d5ba 100%); margin:0; color:#2f3e46; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start;}
    header{padding-top:28px; text-align:center;}
    .logo{width:70px;height:70px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #74c69d, #2d6a4f);display:inline-flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.2);margin-bottom:8px;}
    .logo::before{content:"ğŸ§­";font-size:2rem;color:#fff;}
    h1{margin:6px 0;font-size:1.6rem;}
    p.description{margin:0 20px;line-height:1.6;font-size:1rem;}
    main{width:100%;max-width:420px;padding:20px;box-sizing:border-box;}
    button{display:block;width:100%;padding:16px 18px;margin:12px 0;border:none;border-radius:999px;background:linear-gradient(90deg,#52b788,#40916c);color:#fff;font-size:18px;cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.12);}
    button:active{transform:translateY(1px);}
    #mapLink{margin-top:10px;word-break:break-word;font-weight:600;color:#123e2b;font-size:1rem;}
    .note{font-size:0.95rem;color:#2f3e46;margin-top:10px;}
    .step{background:rgba(255,255,255,0.6);padding:8px 12px;border-radius:12px;margin-bottom:6px;font-weight:600;}
    footer{font-size:0.85rem;padding:12px 8px;color:#495057;text-align:center;}
    a.button-link{text-decoration:none;}
    /* æ‹’çµ•å¾Œæç¤º */
    #permission-popup {
      display:none;
      text-align:center;
      padding:20px;
      margin:20px auto;
      background:rgba(255,255,255,0.9);
      border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
      max-width:380px;
    }
    #permission-popup button {
      margin:8px 0;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo"></div>
    <h1>ğŸ§­ è¿·è·¯æ•‘æ´å®šä½ç³»çµ± / è¿·å­æ•‘æ´ä½ç½®ç¢ºèªã‚·ã‚¹ãƒ†ãƒ </h1>
    <p class="description">
      è‹¥ä½ èˆ‡éšŠä¼èµ°æ•£ï¼Œè«‹ä¾åºæ“ä½œï¼šå–å¾—ä½ çš„ä½ç½®ä¸¦ç™¼é€çµ¦é ˜éšŠã€‚<br>
      ã‚‚ã—éšŠä¼ã¨ã¯ãã‚ŒãŸå ´åˆã¯ã€é †ç•ªã«æ“ä½œã—ã¦ãã ã•ã„ï¼šç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ãƒªãƒ¼ãƒ€ãƒ¼ã«é€ä¿¡ã€‚<br><br>
      ğŸ“ è³‡æ–™åƒ…ç”¨æ–¼å³æ™‚å®šä½ï¼Œä¸æœƒè¢«å„²å­˜ã€‚<br>
      ğŸ“ ãƒ‡ãƒ¼ã‚¿ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ä½ç½®ç¢ºèªã®ã¿ä½¿ç”¨ã•ã‚Œã€ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚
    </p>
  </header>

  <main>
    <div class="step">æ­¥é©Ÿ1ï¼šå–å¾—ä½ çš„ç¾åœ¨ä½ç½® / ã‚¹ãƒ†ãƒƒãƒ—1ï¼šç¾åœ¨åœ°ã‚’å–å¾—</div>
    <button id="getBtn">ğŸ“ å–å¾—ç›®å‰ä½ç½® / ç¾åœ¨åœ°å–å¾—</button>

    <div id="mapLink"></div>

    <div id="actions" style="display:none;">
      <div class="step">æ­¥é©Ÿ2ï¼šç™¼é€ä½ çš„ç¾åœ¨ä½ç½®çµ¦é ˜éšŠ / ã‚¹ãƒ†ãƒƒãƒ—2ï¼šç¾åœ¨åœ°ã‚’ãƒªãƒ¼ãƒ€ãƒ¼ã«é€ä¿¡</div>
      <button id="sendLineBtn">ğŸ’¬ ç™¼é€ç¾åœ¨ä½ç½® / ç¾åœ¨åœ°ã‚’é€ä¿¡</button>
      <button id="copyBtn">ğŸ“‹ è¤‡è£½å®šä½é€£çµ / ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
      <p class="note">
        è‹¥è‡ªå‹•å‚³é€å¤±æ•—ï¼Œå¯æ‰‹å‹•è¤‡è£½é€£çµæˆ–æˆªåœ–é é¢å‚³çµ¦é ˜éšŠã€‚<br>
        è‡ªå‹•é€ä¿¡ã«å¤±æ•—ã—ãŸå ´åˆã¯ã€æ‰‹å‹•ã§ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‹ã€ç”»é¢ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã—ã¦ãƒªãƒ¼ãƒ€ãƒ¼ã«é€ä¿¡ã—ã¦ãã ã•ã„ã€‚
      </p>
    </div>

    <!-- æ‹’çµ•å¾Œæç¤º -->
    <div id="permission-popup">
      <div style="font-size:18px; margin-bottom:12px; font-weight:600;">
        âš ï¸ æ¬Šé™å°šæœªé–‹å•Ÿ / æ¨©é™ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“
      </div>
      <div style="font-size:16px; color:#555; line-height:1.5; margin-bottom:20px;">
        ç‚ºäº†ä½¿ç”¨å®Œæ•´åŠŸèƒ½ï¼Œè«‹å…è¨±ã€å®šä½æ¬Šé™ã€‘ã€‚<br>
        é»æ“Šä¸‹æ–¹æŒ‰éˆ•å³å¯å‰å¾€ç³»çµ±è¨­å®šã€‚<br><br>
        å®Œå…¨ãªæ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã€ã€Œä½ç½®æƒ…å ±ã€ã®æ¨©é™ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚<br>
        ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è¨­å®šç”»é¢ã«ç§»å‹•ã§ãã¾ã™ã€‚
      </div>
      <button id="openSettingsBtn">å‰å¾€è¨­å®š / è¨­å®šã¸</button>
      <button id="closePopupBtn" style="background:#ccc;color:#000;">ç¨å¾Œå†èªª / å¾Œã§</button>
    </div>
  </main>

  <footer>
    ç”±é ˜éšŠæé•·ç´˜è£½ä½œ | Powered by Netlify<br>
    ãƒªãƒ¼ãƒ€ãƒ¼ æé•·ç´˜ ä½œæˆ | Powered by Netlify
  </footer>

  <script>
    let mapUrl = "";
    const getBtn = document.getElementById('getBtn');
    const sendLineBtn = document.getElementById('sendLineBtn');
    const copyBtn = document.getElementById('copyBtn');
    const actions = document.getElementById('actions');
    const mapLinkDiv = document.getElementById('mapLink');

    const popup = document.getElementById('permission-popup');
    const openSettingsBtn = document.getElementById('openSettingsBtn');
    const closePopupBtn = document.getElementById('closePopupBtn');

    getBtn.addEventListener('click', () => {
      if (!navigator.geolocation) {
        alert('æ­¤è£ç½®ä¸æ”¯æ´å®šä½åŠŸèƒ½ / ã“ã®ç«¯æœ«ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚');
        return;
      }
      getBtn.disabled = true;
      getBtn.textContent = 'â³ å–å¾—ä½ç½®ä¸­... / ä½ç½®æƒ…å ±å–å¾—ä¸­...';
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude.toFixed(6);
        const lon = pos.coords.longitude.toFixed(6);
        mapUrl = `https://maps.google.com/?q=${lat},${lon}`;
        mapLinkDiv.innerHTML = `âœ… å®šä½æˆåŠŸï¼<br>ğŸ“Œ æ‚¨çš„ä½ç½®ï¼š<br><a href="${mapUrl}" target="_blank" rel="noopener">${mapUrl}</a><br>âœ… ä½ç½®å–å¾—æˆåŠŸï¼<br>ğŸ“Œ ç¾åœ¨åœ°ï¼š<br><a href="${mapUrl}" target="_blank" rel="noopener">${mapUrl}</a>`;
        actions.style.display = 'block';
        getBtn.disabled = false;
        getBtn.textContent = 'ğŸ“ å–å¾—ç›®å‰ä½ç½® / ç¾åœ¨åœ°å–å¾—';
        actions.scrollIntoView({behavior:'smooth', block:'center'});
        popup.style.display = 'none';
      }, err => {
        getBtn.disabled = false;
        getBtn.textContent = 'ğŸ“ å–å¾—ç›®å‰ä½ç½® / ç¾åœ¨åœ°å–å¾—';
        if (err.code === err.PERMISSION_DENIED) {
          popup.style.display = 'block';
        } else if (err.code === err.POSITION_UNAVAILABLE) {
          alert('âš ï¸ ç„¡æ³•å–å¾—å®šä½è³‡è¨Š / ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚');
        } else if (err.code === err.TIMEOUT) {
          alert('âš ï¸ å®šä½é€¾æ™‚ï¼Œè«‹å†è©¦ä¸€æ¬¡ / ä½ç½®æƒ…å ±å–å¾—ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
        } else {
          alert('âš ï¸ ç™¼ç”ŸéŒ¯èª¤ï¼š' + err.message + ' / ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š' + err.message);
        }
      }, {enableHighAccuracy:true, timeout:15000, maximumAge:0});
    });

    sendLineBtn.addEventListener('click', () => {
      if (!mapUrl) return alert('è«‹å…ˆå–å¾—ä½ç½® / å…ˆã«ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚');
      const message = encodeURIComponent(`æˆ‘ç¾åœ¨çš„ä½ç½®ï¼š${mapUrl} / ç¾åœ¨åœ°ï¼š${mapUrl}`);
      const composeUrl = `https://line.me/R/msg/text/?${message}`;
      window.open(composeUrl, '_blank');
    });

    copyBtn.addEventListener('click', () => {
      if (!mapUrl) return alert('è«‹å…ˆå–å¾—ä½ç½® / å…ˆã«ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚');
      navigator.clipboard.writeText(mapUrl).then(() => {
        alert('ğŸ“‹ å·²è¤‡è£½å®šä½é€£çµï¼Œå¯è²¼ä¸Šå‚³é€çµ¦é ˜éšŠ / ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€ãƒªãƒ¼ãƒ€ãƒ¼ã«é€ä¿¡ã§ãã¾ã™ã€‚');
      }).catch(() => {
        alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹é•·æŒ‰é€£çµæ‰‹å‹•è¤‡è£½ / ã‚³ãƒ”ãƒ¼å¤±æ•—ã€ãƒªãƒ³ã‚¯ã‚’é•·æŠ¼ã—ã—ã¦æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
      });
    });

    openSettingsBtn.addEventListener('click', () => {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      if (/android/i.test(ua)) {
        window.location.href = "intent:#Intent;action=android.settings.APPLICATION_DETAILS_SETTINGS;package=" + location.hostname + ";end";
      } else if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
        alert('è«‹å‰å¾€ã€Œè¨­å®šã€â†’ã€ŒSafariã€â†’ã€Œç¶²ç«™è¨­å®šã€ï¼Œå…è¨±å®šä½æ¬Šé™\nè¨­å®š â†’ Safari â†’ ã‚µã‚¤ãƒˆè¨­å®š â†’ ä½ç½®æƒ…å ±ã‚’è¨±å¯');
      } else {
        alert('è«‹ä½¿ç”¨æ‰‹æ©Ÿæ‰“é–‹æ­¤é ï¼Œä¸¦æ‰‹å‹•é–‹å•Ÿå®šä½æ¬Šé™\nã‚¹ãƒãƒ›ã§ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€æ‰‹å‹•ã§ä½ç½®æƒ…å ±ã‚’è¨±å¯ã—ã¦ãã ã•ã„');
      }
    });

    closePopupBtn.addEventListener('click', () => {
      popup.style.display = 'none';
    });
  </script>
</body>
</html>
